# Библиотека команд Jarvis

Это директория с голосовыми командами для ассистента Jarvis.

## Структура команд

Каждая категория команд находится в отдельной папке:

```
commands/
├── media/          # Медиа команды (музыка, видео)
├── automation/     # Автоматизация (сценарии, макросы)
├── system/         # Системные команды
├── info/           # Информационные команды
└── custom/         # Кастомные пользовательские команды
```

## Формат команды (command.yaml)

```yaml
list:
  - command:
      action: "voice"  # Тип: voice, cli, ahk, terminate, stop_chaining
      cli_cmd: "echo"  # Для action: cli
      cli_args: ["Hello World"]
    voice:
      sounds:
        - "yes_sir"
        - "ready"
        - "done"
    phrases:
      - "привет"
      - "hello"
```

## Типы действий (action)

### 1. `voice` - Голосовой ответ
Просто проигрывает случайный звук из списка `voice.sounds`.

```yaml
- command:
    action: "voice"
  voice:
    sounds:
      - "yes_sir"
      - "ready"
  phrases:
    - "привет джарвис"
    - "здравствуй"
```

### 2. `cli` - Запуск CLI команды
Выполняет системную команду в терминале.

```yaml
- command:
    action: "cli"
    cli_cmd: "vlc"
    cli_args: ["--started-from-file"]
  voice:
    sounds:
      - "done"
  phrases:
    - "включи музыку"
    - "запусти плеер"
```

### 3. `ahk` - AutoHotkey скрипт (Windows)
Запускает AutoHotkey скрипт.

```yaml
- command:
    action: "ahk"
    exe_path: "C:/scripts/myscript.ahk"
    exe_args: []
  voice:
    sounds:
      - "yes_sir"
  phrases:
    - "запусти скрипт"
```

### 4. `terminate` - Выход из программы
Завершает работу ассистента с задержкой 2 секунды.

```yaml
- command:
    action: "terminate"
  voice:
    sounds:
      - "goodbye"
  phrases:
    - "выключись"
    - "завершить работу"
```

### 5. `stop_chaining` - Остановка цепочки команд
Останавливает выполнение следующих команд в цепочке.

```yaml
- command:
    action: "stop_chaining"
  voice:
    sounds:
      - "done"
  phrases:
    - "хватит"
    - "достаточно"
```

## Добавление новой команды

1. Создайте папку в `commands/`, например `commands/my_category/`
2. Создайте файл `command.yaml` в этой папке
3. Опишите команды по формату выше
4. Перезапустите ассистента

## Распознавание фраз

Ассистент использует алгоритм сравнения последовательностей (seqdiff) для поиска наиболее похожей команды.

- Порог совпадения: 65% (настраивается в `config.rs`: `CMD_RATIO_THRESHOLD`)
- Не чувствителен к регистру
- Убирает служебные слова ("джарвис", "сэр", "пожалуйста" и т.д.)

## Звуковые файлы

Звуковые файлы должны быть в формате `.wav` и находиться в папке:
```
sound/
├── jarvis-og/      # Оригинальный голос из фильмов
│   ├── yes_sir.wav
│   ├── ready.wav
│   ├── done.wav
│   └── goodbye.wav
└── jarvis-remake/  # Ремейк от Хауди Хо
    ├── yes_sir.wav
    ├── ready.wav
    └── ...
```

## Примеры готовых команд

### Медиа
- "включи музыку" - запускает VLC
- "пауза" - ставит на паузу
- "выключи музыку" - закрывает плеер

### Система
- "какое время" - озвучивает время
- "выключись" - завершает работу ассистента
- "хватит" - останавливает цепочку команд

### Информация
- "какая погода" - информация о погоде
- "новости дня" - последние новости
- "список команд" - показывает доступные команды

## Расширенные возможности

### Цепочки команд
Команды могут быть выполнены цепочкой, если они возвращают `true`:

```rust
Ok(true)  // Продолжить слушать следующую команду
Ok(false) // Остановить цепочку (stop_chaining)
```

### Фильтрация слов
Список слов, которые автоматически удаляются из распознанной фразы:
- "джарвис"
- "сэр"
- "пожалуйста"
- "скажи"
- "покажи"
- и другие (см. `ASSISTANT_PHRASES_TBR` в `config.rs`)

## Отладка

Логи распознавания команд можно найти в:
- Windows: `%APPDATA%/com.priler.jarvis/log.txt`
- Linux: `~/.config/com.priler.jarvis/log.txt`

Для увеличения порога распознавания измените `CMD_RATIO_THRESHOLD` в `config.rs`.
